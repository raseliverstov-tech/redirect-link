export default {
  async fetch(request) {
    const url = new URL(request.url);
    const target = url.searchParams.get('target');

    if (!target) {
      return new Response('❌ No target URL provided', { status: 400 });
    }

    // Собираем все UTM и другие параметры кроме target
    const params = new URLSearchParams();
    url.searchParams.forEach((v, k) => {
      if (k !== 'target') params.set(k, v);
    });

    const finalUrl = target + (params.toString() ? (target.includes('?') ? '&' : '?') + params.toString() : '');

    // Можно добавить лог hit в Яндекс.Метрику через URL
    // ym? Или через обычный redirect - МЕТРИКА фиксирует переход как GET
    return Response.redirect(finalUrl, 302);
  }
};


