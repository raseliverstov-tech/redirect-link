addEventListener('fetch', event => {
  event.respondWith(handleRequest(event.request))
})

async function handleRequest(request) {
  const url = new URL(request.url)
  const target = url.searchParams.get('target')
  if (!target) return new Response('Missing target', { status: 400 })

  // Формируем ссылку для Яндекс.Метрики
  const ymCounter = 105090249  // Твой счётчик Метрики
  const ymUrl = `https://mc.yandex.ru/watch/${ymCounter}?ut=${encodeURIComponent(request.url)}`

  // Отправка hit в Метрику (fire-and-forget)
  fetch(ymUrl, { method: 'GET', mode: 'no-cors' })

  // Мгновенный редирект на target
  return Response.redirect(target, 302)
}

